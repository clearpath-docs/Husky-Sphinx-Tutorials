



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Driving Husky &mdash; Husky UGV Tutorials 0.5.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/clearpath.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Husky UGV Tutorials 0.5.1 documentation" href="index.html"/>
        <link rel="next" title="Husky Move Base Demo" href="HuskyMove.html"/>
        <link rel="prev" title="Interfacing with Husky" href="InterfacingWithHusky.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

  <!-- Start of clearpathrobotics Zendesk Widget script -->
<script>/*<![CDATA[​*/window.zEmbed||function(e,t){var n,o,d,i,s,a=[],r=document.createElement("iframe");window.zEmbed=function(){a.push(arguments)},window.zE=window.zE||window.zEmbed,r.src="javascript:false",r.title="",r.role="presentation",(r.frameElement||r).style.cssText="display: none",d=document.getElementsByTagName("script"),d=d[d.length-1],d.parentNode.insertBefore(r,d),i=r.contentWindow,s=i.document;try{o=s}catch(c){n=document.domain,r.src='javascript:var d=document.open();d.domain="'+n+'";void(0);',o=s}o.open()._l=function(){var o=this.createElement("script");n&&(this.domain=n),o.id="js-iframe-async",o.src=e,this.t=+new Date,this.zendeskHost=t,this.zEQueue=a,this.body.appendChild(o)},o.write('<body onload="document._l();">'),o.close()}("https://assets.zendesk.com/embeddable_framework/main.js","clearpathrobotics.zendesk.com");/*​]]>*/</script>
<!-- End of clearpathrobotics Zendesk Widget script -->

<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-65409991-1', 'auto');
 ga('send', 'pageview');

</script>


</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Husky UGV Tutorials
          

          
            
            <img src="_static/clearpathlogo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search..." />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="BackUpHusky.html">Backing Up Husky Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="InstallHuskySoftware.html">Install and Configure Husky Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="CustomizeHuskyConfig.html">Customize Husky Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Using Husky</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SimulatingHusky.html">Simulating Husky</a></li>
<li class="toctree-l1"><a class="reference internal" href="InterfacingWithHusky.html">Interfacing with Husky</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Driving Husky</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#updating-the-virtual-machine">Updating the Virtual Machine</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-a-virtual-husky">Running a Virtual Husky</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-rqt-graph">Using rqt_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-tf">Using tf</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#operating-a-physical-husky">Operating a Physical Husky</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#safety-precautions">Safety Precautions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#controller-pairing">Controller Pairing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#teleoperation">Teleoperation</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Demo Applications: Navigation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HuskyMove.html">Husky Move Base Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="HuskyAMCL.html">Husky AMCL Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="HuskyGmapping.html">Husky Gmapping Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="HuskyFrontiers.html">Husky Frontier Exploration Demo</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="HuskyPackages.html">Husky Packages</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Husky UGV Tutorials</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
     
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="http://support.clearpathrobotics.com">Home</a> &raquo;</li>
      
    <li>Driving Husky</li>
      <li class="wy-breadcrumbs-aside">
        <div class="roslogo">
      </div>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="driving-husky">
<h1>Driving Husky<a class="headerlink" href="#driving-husky" title="Permalink to this headline">¶</a></h1>
<div class="section" id="updating-the-virtual-machine">
<h2>Updating the Virtual Machine<a class="headerlink" href="#updating-the-virtual-machine" title="Permalink to this headline">¶</a></h2>
<p>Open a terminal window (Ctrl + Alt + T), and enter the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">ros</span><span class="o">-</span><span class="n">kinetic</span><span class="o">-</span><span class="n">husky</span><span class="o">-</span><span class="n">desktop</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">ros</span><span class="o">-</span><span class="n">kinetic</span><span class="o">-</span><span class="n">husky</span><span class="o">-</span><span class="n">simulator</span>
</pre></div>
</div>
</div>
<div class="section" id="running-a-virtual-husky">
<h2>Running a Virtual Husky<a class="headerlink" href="#running-a-virtual-husky" title="Permalink to this headline">¶</a></h2>
<p>Open a terminal window, and enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">husky_gazebo</span> <span class="n">husky_empty_world</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>Open another terminal window, and enter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roslaunch</span> <span class="n">husky_viz</span> <span class="n">view_robot</span><span class="o">.</span><span class="n">launch</span>
</pre></div>
</div>
<p>You should be given two windows, both showing a yellow, rugged robot (Husky!)</p>
<p><strong>RViz</strong></p>
<a class="reference internal image-reference" href="_images/Huskyviz.png"><img alt="_images/Huskyviz.png" src="_images/Huskyviz.png" style="width: 768.5px; height: 452.5px;" /></a>
<p><strong>Gazebo</strong></p>
<a class="reference internal image-reference" href="_images/Huskysim.png"><img alt="_images/Huskysim.png" src="_images/Huskysim.png" style="width: 767.0px; height: 398.5px;" /></a>
<p>The left one shown is Gazebo. This is where we get a realistic simulation of our robot, including wheel slippage, skidding, and inertia.
We can add objects to this simulation, such as the cube above, or even entire maps of real places.</p>
<p>The right window is RViz. This tool allows us to see sensor data from a robot, and give it commands (in a future post).</p>
<p>We can now command the robot to go forwards. Open a terminal window, and use the command below, copy pasting this one won’t work! You can tab complete this command by hitting the tab key after geometry_msgs/Twist:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rostopic</span> <span class="n">pub</span> <span class="o">/</span><span class="n">husky_velocity_controller</span><span class="o">/</span><span class="n">cmd_vel</span> <span class="n">geometry_msgs</span><span class="o">/</span><span class="n">Twist</span> <span class="s2">&quot;linear:</span>
        <span class="n">x</span><span class="p">:</span> <span class="mf">0.5</span>
        <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="n">z</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="n">angular</span><span class="p">:</span>
        <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span>
        <span class="n">z</span><span class="p">:</span> <span class="mf">0.0</span><span class="s2">&quot; -r 10</span>
</pre></div>
</div>
<p>In the above command, we publish to the <strong>/husky_velocity_controller/cmd_vel topic</strong>, of topic type <strong>geometry_msgs/Twist</strong>.
The data we publish tells the simulated Husky to go forwards at 0.5m/s, without any rotation. You should see your Husky move forwards.
In the gazebo window, you might notice simulated wheel slip, and skidding.</p>
</div>
<div class="section" id="using-rqt-graph">
<h2>Using rqt_graph<a class="headerlink" href="#using-rqt-graph" title="Permalink to this headline">¶</a></h2>
<p>We can also see the structure of how topics are passed around the system. Leave the publishing window running, and open a terminal window. Type in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">rqt_graph</span> <span class="n">rqt_graph</span>
</pre></div>
</div>
<p>This command generates a representation of how the nodes and topics running on the current ROS Master are related. You should get something similar to the following:</p>
<img alt="_images/rqtgraph.png" src="_images/rqtgraph.png" />
<p>The highlighted node and arrow show the topic that you are publishing to the simulated Husky. This Husky then goes on to update the gazebo virtual environment,
which takes care of movement of the joints (wheels) and the physics of the robot.
The rqt_graph command is very handy to use, when you are unsure who is publishing to what in ROS.
Once you figure out what topic you are interested in, you can see the content of the topic using <strong>rostopic echo</strong>.</p>
</div>
<div class="section" id="using-tf">
<h2>Using tf<a class="headerlink" href="#using-tf" title="Permalink to this headline">¶</a></h2>
<p>In ROS, tf is a special topic that keeps track of coordinate frames, and how they relate to each other.
So, our simulated Husky starts at (0,0,0) in the world coordinate frame. When the Husky moves, it’s own coordinate frame changes.
Each wheel has a coordinate frame that tracks how it is rotating, and where it is. Generally, anything on the robot that is not fixed in space, will have a tf describing it.
In the <strong>rqt_graph section</strong>, you can see that the <strong>/tf topic</strong> is published to and subscribed from by many different nodes.</p>
<p>One intuitive way to see how the tf topic is structured for a robot is to use the <strong>view_frames</strong> tool provided by ROS. Open a terminal window. Type in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rosrun</span> <span class="n">tf</span> <span class="n">view_frames</span>
</pre></div>
</div>
<p>Wait for this to complete, and then type in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">evince</span> <span class="n">frames</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>This will bring up something similar to the following image.</p>
<img alt="_images/tfframes.png" src="_images/tfframes.png" />
<p>Here we can see that all four wheel are referenced to the <strong>base_link</strong>. We also see that the <strong>odom topic</strong> is driving the reference of the whole robot.
This means that if you write to the <strong>odom topic</strong> (IE, when you publish to the <strong>/cmd_vel topic</strong>) then the whole robot will move.</p>
</div>
</div>
<div class="section" id="operating-a-physical-husky">
<h1>Operating a Physical Husky<a class="headerlink" href="#operating-a-physical-husky" title="Permalink to this headline">¶</a></h1>
<p>Husky can either drive autonomously, be <a class="reference internal" href="SimulatingHusky.html"><span class="doc">controlled through ROS messages</span></a>, or you
can use the supplied remote control to teleoperate it.</p>
<div class="section" id="safety-precautions">
<h2>Safety Precautions<a class="headerlink" href="#safety-precautions" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Husky is a heavy, robot capable of reaching high speeds.  Careless driving can cause harm to the operator,
bystanders, the robot, or other property.  Always remain vigilant, ensure you have a clear line of sight to the
robot, and operate the robot at safe speeds.</p>
</div>
</div>
<div class="section" id="controller-pairing">
<h2>Controller Pairing<a class="headerlink" href="#controller-pairing" title="Permalink to this headline">¶</a></h2>
<p>Husky ships with a standard game controller of varying models.  On newer robots this is a Sony Playstation 4 controller,
but some older models may ship with a Logitech F710 controller.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Logitech F710 controller uses a USB dongle for pairing.  The robot should connect automatically to the
controller when the dongle is inserted into a USB port and the controller is powered on.</p>
</div>
<p>To pair the PS4 controller with the robot, run the <code class="docutils literal notranslate"><span class="pre">bluetoothctl</span></code> command on the robot, put the controller in pairing
mode by pressing and holding the Share and PS buttons, and enter the following sub-commands:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>agent on
scan on
</pre></div>
</div>
<p>The bluetooth scan will display the MAC addresses to nearby devices.  Determine with MAC address corresponds to the
controller and copy it.  Then run the following commands in bluetoothctl:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>scan off
pair &lt;MAC Address&gt;
trust &lt;MAC Address&gt;
connect &lt;MAC Address&gt;
</pre></div>
</div>
<p>The controller should now be correctly paired.</p>
</div>
<div class="section" id="teleoperation">
<h2>Teleoperation<a class="headerlink" href="#teleoperation" title="Permalink to this headline">¶</a></h2>
<p>To enable the controller you must hold down either the left or right shoulder buttons on the controller (L1 and R1 on
the PS4 controller, or LB and RB on the Logitech F710).  The left button is for normal operation, while the right
button enables turbo speed.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When familiarizing yourself with Husky’s operation, always hold the left button (L1/LB).  Once you are comfortable
with how Husky operates, and you are in a large area with plenty of open room, then you can use R1/RB to enable
turbo mode.</p>
</div>
<p>Once the controller is paired, you can use the left thumb-stick to drive the robot.  The vertical axis controls
the robot’s speed and the horizontal axis controls the robot’s turning.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="HuskyMove.html" class="btn btn-neutral float-right" title="Husky Move Base Demo" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="InterfacingWithHusky.html" class="btn btn-neutral" title="Interfacing with Husky" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Clearpath Robotics.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>